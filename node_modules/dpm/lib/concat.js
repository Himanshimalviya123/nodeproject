var path = require('path')
var _ = require('underscore');
var fs = require('fs');
var wrench = require('wrench');
var colorized = require('console-colorjs');

module.exports = function(dir) {
    var includeFilePath = path.join(dir, 'include-all.js');

    if (fs.existsSync(includeFilePath)) {
        fs.unlinkSync(includeFilePath);
    }

    var code = wrench.readdirSyncRecursive(dir).filter(function(file) {
        return path.extname(file) === '.js';
    }).map(function(file) {
        return 'require(\'./' + file.replace(/\\/g, '/') +  '\');';
    }).join('\n    ');


    code = 'define(function(require){\n    ' + code + '\n});'

    fs.writeFileSync(includeFilePath, code, 'utf8');      
    console.log(colorized.bright(includeFilePath) + ' created'); 
}